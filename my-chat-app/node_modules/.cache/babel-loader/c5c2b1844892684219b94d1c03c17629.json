{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\video\\\\Desktop\\\\PythonProject1\\\\my-chat-app\\\\src\\\\ChatBox.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport axios from 'axios';\nconst socket = io('http://localhost:3001'); // NestJS WebSocket port\n\nconst ChatBox = () => {\n  const [sender, setSender] = useState('');\n  const [text, setText] = useState('');\n  const [messages, setMessages] = useState([]);\n  useEffect(() => {\n    console.log('📡 WebSocket connection started');\n    socket.on('message', message => {\n      console.log('📥 Message received via WebSocket:', message);\n\n      // Add only user messages (not AI-generated ones)\n      if (!message.isGenerated) {\n        setMessages(prev => [...prev, message]);\n      }\n    });\n    return () => {\n      socket.off('message');\n      console.log('🔌 WebSocket connection closed');\n    };\n  }, []);\n  const sendMessage = async () => {\n    if (!sender.trim() || !text.trim()) {\n      console.warn('⚠️ Username or message is empty, canceled.');\n      return;\n    }\n    const userMsg = {\n      sender,\n      text,\n      isGenerated: false\n    };\n    console.log('✉️ Sending user message:', userMsg);\n\n    // Do not add it locally; wait for it to return via WebSocket\n    socket.emit('message', userMsg);\n    console.log('📡 Message sent via WebSocket');\n    const loadingMsg = {\n      sender: 'AI',\n      text: 'Typing...',\n      isGenerated: true\n    };\n    setMessages(prev => [...prev, loadingMsg]);\n    console.log('⏳ \"Typing...\" message added');\n    try {\n      console.log('🔗 Calling FastAPI...');\n      const response = await axios.post('http://localhost:8000/ai', {\n        message: text\n      });\n      console.log('✅ FastAPI response:', response.data);\n      const aiMsg = {\n        sender: 'AI',\n        text: response.data.response,\n        isGenerated: true\n      };\n      setMessages(prev => {\n        const updated = [...prev];\n        const index = updated.findIndex(m => m.sender === 'AI' && m.text === 'Typing...');\n        if (index !== -1) updated.splice(index, 1);\n        return [...updated, aiMsg];\n      });\n      console.log('🤖 AI response added to chat:', aiMsg);\n    } catch (err) {\n      var _err$response;\n      console.error('❌ FastAPI error:', ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err.message || err);\n      setMessages(prev => [...prev.filter(m => m.text !== 'Typing...'), {\n        sender: 'AI',\n        text: '[Error in AI response]',\n        isGenerated: true\n      }]);\n    }\n    setText('');\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 9\n    }\n  }, \"Realtime Chat + AI\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    value: sender,\n    onChange: e => setSender(e.target.value),\n    placeholder: \"Your name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    value: text,\n    onChange: e => setText(e.target.value),\n    onKeyDown: e => e.key === 'Enter' && sendMessage(),\n    placeholder: \"Message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 11\n    }\n  }, \"Send\")), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  }, messages.map((msg, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    className: msg.isGenerated ? 'ai' : 'user',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"message-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 19\n    }\n  }, msg.isGenerated ? '🤖' : '👤'), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bubble\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 21\n    }\n  }, msg.sender, \":\"), \" \", msg.text))))));\n};\nexport default ChatBox;","map":{"version":3,"names":["React","useEffect","useState","io","axios","socket","ChatBox","sender","setSender","text","setText","messages","setMessages","console","log","on","message","isGenerated","prev","off","sendMessage","trim","warn","userMsg","emit","loadingMsg","response","post","data","aiMsg","updated","index","findIndex","m","splice","err","_err$response","error","filter","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","placeholder","onKeyDown","key","onClick","map","msg","i"],"sources":["C:/Users/video/Desktop/PythonProject1/my-chat-app/src/ChatBox.tsx"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {io, Socket} from 'socket.io-client';\r\nimport axios from 'axios';\r\nimport {Message} from './types';\r\n\r\nconst socket: Socket = io('http://localhost:3001'); // NestJS WebSocket port\r\n\r\nconst ChatBox: React.FC = () => {\r\n  const [sender, setSender] = useState('');\r\n  const [text, setText] = useState('');\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n\r\n  useEffect(() => {\r\n    console.log('📡 WebSocket connection started');\r\n\r\n    socket.on('message', (message: Message) => {\r\n      console.log('📥 Message received via WebSocket:', message);\r\n\r\n      // Add only user messages (not AI-generated ones)\r\n      if (!message.isGenerated) {\r\n        setMessages((prev) => [...prev, message]);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.off('message');\r\n      console.log('🔌 WebSocket connection closed');\r\n    };\r\n  }, []);\r\n\r\n  const sendMessage = async () => {\r\n    if (!sender.trim() || !text.trim()) {\r\n      console.warn('⚠️ Username or message is empty, canceled.');\r\n      return;\r\n    }\r\n\r\n    const userMsg: Message = {\r\n      sender,\r\n      text,\r\n      isGenerated: false,\r\n    };\r\n\r\n    console.log('✉️ Sending user message:', userMsg);\r\n\r\n    // Do not add it locally; wait for it to return via WebSocket\r\n    socket.emit('message', userMsg);\r\n    console.log('📡 Message sent via WebSocket');\r\n\r\n    const loadingMsg: Message = {\r\n      sender: 'AI',\r\n      text: 'Typing...',\r\n      isGenerated: true,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, loadingMsg]);\r\n    console.log('⏳ \"Typing...\" message added');\r\n\r\n    try {\r\n      console.log('🔗 Calling FastAPI...');\r\n      const response = await axios.post('http://localhost:8000/ai', {\r\n        message: text,\r\n      });\r\n      console.log('✅ FastAPI response:', response.data);\r\n\r\n      const aiMsg: Message = {\r\n        sender: 'AI',\r\n        text: response.data.response,\r\n        isGenerated: true,\r\n      };\r\n\r\n      setMessages((prev) => {\r\n        const updated = [...prev];\r\n        const index = updated.findIndex(\r\n            (m) => m.sender === 'AI' && m.text === 'Typing...'\r\n        );\r\n        if (index !== -1) updated.splice(index, 1);\r\n        return [...updated, aiMsg];\r\n      });\r\n\r\n      console.log('🤖 AI response added to chat:', aiMsg);\r\n    } catch (err: any) {\r\n      console.error(\r\n          '❌ FastAPI error:',\r\n          err.response?.data || err.message || err\r\n      );\r\n\r\n      setMessages((prev) => [\r\n        ...prev.filter((m) => m.text !== 'Typing...'),\r\n        {\r\n          sender: 'AI',\r\n          text: '[Error in AI response]',\r\n          isGenerated: true,\r\n        },\r\n      ]);\r\n    }\r\n\r\n    setText('');\r\n  };\r\n\r\n  return (\r\n      <div className=\"chat-container\">\r\n        <h1>Realtime Chat + AI</h1>\r\n        <div className=\"input-group\">\r\n          <input\r\n              value={sender}\r\n              onChange={(e) => setSender(e.target.value)}\r\n              placeholder=\"Your name\"\r\n          />\r\n          <input\r\n              value={text}\r\n              onChange={(e) => setText(e.target.value)}\r\n              onKeyDown={(e) => e.key === 'Enter' && sendMessage()}\r\n              placeholder=\"Message\"\r\n          />\r\n          <button onClick={sendMessage}>Send</button>\r\n        </div>\r\n\r\n        <ul>\r\n          {messages.map((msg, i) => (\r\n              <li key={i} className={msg.isGenerated ? 'ai' : 'user'}>\r\n                <div className=\"message-row\">\r\n                  <span className=\"avatar\">{msg.isGenerated ? '🤖' : '👤'}</span>\r\n                  <div className=\"bubble\">\r\n                    <strong>{msg.sender}:</strong> {msg.text}\r\n                  </div>\r\n                </div>\r\n              </li>\r\n          ))}\r\n        </ul>\r\n      </div>\r\n  );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":";AAAA,OAAOA,KAAK,IAAGC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AAChD,SAAQC,EAAE,QAAe,kBAAkB;AAC3C,OAAOC,KAAK,MAAM,OAAO;AAGzB,MAAMC,MAAc,GAAGF,EAAE,CAAC,uBAAuB,CAAC,CAAC,CAAC;;AAEpD,MAAMG,OAAiB,GAAGA,CAAA,KAAM;EAC9B,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGN,QAAQ,CAAC,EAAE,CAAC;EACxC,MAAM,CAACO,IAAI,EAAEC,OAAO,CAAC,GAAGR,QAAQ,CAAC,EAAE,CAAC;EACpC,MAAM,CAACS,QAAQ,EAAEC,WAAW,CAAC,GAAGV,QAAQ,CAAY,EAAE,CAAC;EAEvDD,SAAS,CAAC,MAAM;IACdY,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC;IAE9CT,MAAM,CAACU,EAAE,CAAC,SAAS,EAAGC,OAAgB,IAAK;MACzCH,OAAO,CAACC,GAAG,CAAC,oCAAoC,EAAEE,OAAO,CAAC;;MAE1D;MACA,IAAI,CAACA,OAAO,CAACC,WAAW,EAAE;QACxBL,WAAW,CAAEM,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEF,OAAO,CAAC,CAAC;MAC3C;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MACXX,MAAM,CAACc,GAAG,CAAC,SAAS,CAAC;MACrBN,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC;IAC/C,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMM,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,IAAI,CAACb,MAAM,CAACc,IAAI,CAAC,CAAC,IAAI,CAACZ,IAAI,CAACY,IAAI,CAAC,CAAC,EAAE;MAClCR,OAAO,CAACS,IAAI,CAAC,4CAA4C,CAAC;MAC1D;IACF;IAEA,MAAMC,OAAgB,GAAG;MACvBhB,MAAM;MACNE,IAAI;MACJQ,WAAW,EAAE;IACf,CAAC;IAEDJ,OAAO,CAACC,GAAG,CAAC,0BAA0B,EAAES,OAAO,CAAC;;IAEhD;IACAlB,MAAM,CAACmB,IAAI,CAAC,SAAS,EAAED,OAAO,CAAC;IAC/BV,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAC;IAE5C,MAAMW,UAAmB,GAAG;MAC1BlB,MAAM,EAAE,IAAI;MACZE,IAAI,EAAE,WAAW;MACjBQ,WAAW,EAAE;IACf,CAAC;IAEDL,WAAW,CAAEM,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEO,UAAU,CAAC,CAAC;IAC5CZ,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;IAE1C,IAAI;MACFD,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC;MACpC,MAAMY,QAAQ,GAAG,MAAMtB,KAAK,CAACuB,IAAI,CAAC,0BAA0B,EAAE;QAC5DX,OAAO,EAAEP;MACX,CAAC,CAAC;MACFI,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEY,QAAQ,CAACE,IAAI,CAAC;MAEjD,MAAMC,KAAc,GAAG;QACrBtB,MAAM,EAAE,IAAI;QACZE,IAAI,EAAEiB,QAAQ,CAACE,IAAI,CAACF,QAAQ;QAC5BT,WAAW,EAAE;MACf,CAAC;MAEDL,WAAW,CAAEM,IAAI,IAAK;QACpB,MAAMY,OAAO,GAAG,CAAC,GAAGZ,IAAI,CAAC;QACzB,MAAMa,KAAK,GAAGD,OAAO,CAACE,SAAS,CAC1BC,CAAC,IAAKA,CAAC,CAAC1B,MAAM,KAAK,IAAI,IAAI0B,CAAC,CAACxB,IAAI,KAAK,WAC3C,CAAC;QACD,IAAIsB,KAAK,KAAK,CAAC,CAAC,EAAED,OAAO,CAACI,MAAM,CAACH,KAAK,EAAE,CAAC,CAAC;QAC1C,OAAO,CAAC,GAAGD,OAAO,EAAED,KAAK,CAAC;MAC5B,CAAC,CAAC;MAEFhB,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEe,KAAK,CAAC;IACrD,CAAC,CAAC,OAAOM,GAAQ,EAAE;MAAA,IAAAC,aAAA;MACjBvB,OAAO,CAACwB,KAAK,CACT,kBAAkB,EAClB,EAAAD,aAAA,GAAAD,GAAG,CAACT,QAAQ,cAAAU,aAAA,uBAAZA,aAAA,CAAcR,IAAI,KAAIO,GAAG,CAACnB,OAAO,IAAImB,GACzC,CAAC;MAEDvB,WAAW,CAAEM,IAAI,IAAK,CACpB,GAAGA,IAAI,CAACoB,MAAM,CAAEL,CAAC,IAAKA,CAAC,CAACxB,IAAI,KAAK,WAAW,CAAC,EAC7C;QACEF,MAAM,EAAE,IAAI;QACZE,IAAI,EAAE,wBAAwB;QAC9BQ,WAAW,EAAE;MACf,CAAC,CACF,CAAC;IACJ;IAEAP,OAAO,CAAC,EAAE,CAAC;EACb,CAAC;EAED,oBACIV,KAAA,CAAAuC,aAAA;IAAKC,SAAS,EAAC,gBAAgB;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC7B9C,KAAA,CAAAuC,aAAA;IAAAE,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAI,oBAAsB,CAAC,eAC3B9C,KAAA,CAAAuC,aAAA;IAAKC,SAAS,EAAC,aAAa;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC1B9C,KAAA,CAAAuC,aAAA;IACIQ,KAAK,EAAExC,MAAO;IACdyC,QAAQ,EAAGC,CAAC,IAAKzC,SAAS,CAACyC,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE;IAC3CI,WAAW,EAAC,WAAW;IAAAV,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CAC1B,CAAC,eACF9C,KAAA,CAAAuC,aAAA;IACIQ,KAAK,EAAEtC,IAAK;IACZuC,QAAQ,EAAGC,CAAC,IAAKvC,OAAO,CAACuC,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE;IACzCK,SAAS,EAAGH,CAAC,IAAKA,CAAC,CAACI,GAAG,KAAK,OAAO,IAAIjC,WAAW,CAAC,CAAE;IACrD+B,WAAW,EAAC,SAAS;IAAAV,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CACxB,CAAC,eACF9C,KAAA,CAAAuC,aAAA;IAAQe,OAAO,EAAElC,WAAY;IAAAqB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,MAAY,CACvC,CAAC,eAEN9C,KAAA,CAAAuC,aAAA;IAAAE,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GACGnC,QAAQ,CAAC4C,GAAG,CAAC,CAACC,GAAG,EAAEC,CAAC,kBACjBzD,KAAA,CAAAuC,aAAA;IAAIc,GAAG,EAAEI,CAAE;IAACjB,SAAS,EAAEgB,GAAG,CAACvC,WAAW,GAAG,IAAI,GAAG,MAAO;IAAAwB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACrD9C,KAAA,CAAAuC,aAAA;IAAKC,SAAS,EAAC,aAAa;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC1B9C,KAAA,CAAAuC,aAAA;IAAMC,SAAS,EAAC,QAAQ;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAEU,GAAG,CAACvC,WAAW,GAAG,IAAI,GAAG,IAAW,CAAC,eAC/DjB,KAAA,CAAAuC,aAAA;IAAKC,SAAS,EAAC,QAAQ;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACrB9C,KAAA,CAAAuC,aAAA;IAAAE,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAASU,GAAG,CAACjD,MAAM,EAAC,GAAS,CAAC,KAAC,EAACiD,GAAG,CAAC/C,IACjC,CACF,CACH,CACP,CACC,CACD,CAAC;AAEZ,CAAC;AAED,eAAeH,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module"}