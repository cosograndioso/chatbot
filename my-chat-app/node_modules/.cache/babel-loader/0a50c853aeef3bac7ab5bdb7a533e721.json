{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\video\\\\Desktop\\\\PythonProject1\\\\my-chat-app\\\\src\\\\ChatBox.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport axios from 'axios';\nconst socket = io('http://localhost:3001'); // Porta NestJS WebSocket\n\nconst ChatBox = () => {\n  const [sender, setSender] = useState('');\n  const [text, setText] = useState('');\n  const [messages, setMessages] = useState([]);\n  useEffect(() => {\n    console.log('📡 Connessione WebSocket avviata');\n    socket.on('message', message => {\n      console.log('📥 Messaggio ricevuto via WebSocket:', message);\n\n      // Mostra subito il messaggio dell’utente\n      if (!message.isGenerated) {\n        setMessages(prev => [...prev, message]);\n      }\n    });\n    return () => {\n      socket.off('message');\n      console.log('🔌 Connessione WebSocket chiusa');\n    };\n  }, []);\n  const sendMessage = async () => {\n    if (!sender.trim() || !text.trim()) {\n      console.warn('⚠️ Nome utente o messaggio vuoto, annullato.');\n      return;\n    }\n    const userMsg = {\n      sender,\n      text,\n      isGenerated: false\n    };\n    console.log('✉️ Invio messaggio utente:', userMsg);\n    setMessages(prev => [...prev, userMsg]);\n    socket.emit('message', userMsg);\n    console.log('📡 Messaggio inviato via WebSocket');\n    const loadingMsg = {\n      sender: 'AI',\n      text: 'Sta scrivendo...',\n      isGenerated: true\n    };\n    setMessages(prev => [...prev, loadingMsg]);\n    console.log('⏳ Messaggio \"Sta scrivendo...\" aggiunto');\n    try {\n      console.log('🔗 Chiamata a FastAPI...');\n      const response = await axios.post('http://localhost:8000/ai', {\n        message: text\n      });\n      console.log('✅ Risposta FastAPI:', response.data);\n      const aiMsg = {\n        sender: 'AI',\n        text: response.data.response,\n        isGenerated: true\n      };\n      setMessages(prev => {\n        const updated = [...prev];\n        const index = updated.findIndex(m => m.sender === 'AI' && m.text === 'Sta scrivendo...');\n        if (index !== -1) updated.splice(index, 1);\n        return [...updated, aiMsg];\n      });\n      console.log('🤖 Risposta AI aggiunta alla chat:', aiMsg);\n    } catch (err) {\n      var _err$response;\n      console.error('❌ Errore FastAPI:', ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err.message || err);\n      setMessages(prev => [...prev.filter(m => m.text !== 'Sta scrivendo...'), {\n        sender: 'AI',\n        text: '[Errore nella risposta AI]',\n        isGenerated: true\n      }]);\n    }\n    setText('');\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, \"Chat Realtime + AI\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    value: sender,\n    onChange: e => setSender(e.target.value),\n    placeholder: \"Your name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    value: text,\n    onChange: e => setText(e.target.value),\n    onKeyDown: e => e.key === 'Enter' && sendMessage(),\n    placeholder: \"Message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }\n  }, \"Send\")), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, messages.map((msg, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    className: msg.isGenerated ? 'ai' : 'user',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"message-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 15\n    }\n  }, msg.isGenerated ? '🤖' : '👤'), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bubble\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 17\n    }\n  }, msg.sender, \":\"), \" \", msg.text))))));\n};\nexport default ChatBox;","map":{"version":3,"names":["React","useEffect","useState","io","axios","socket","ChatBox","sender","setSender","text","setText","messages","setMessages","console","log","on","message","isGenerated","prev","off","sendMessage","trim","warn","userMsg","emit","loadingMsg","response","post","data","aiMsg","updated","index","findIndex","m","splice","err","_err$response","error","filter","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","placeholder","onKeyDown","key","onClick","map","msg","i"],"sources":["C:/Users/video/Desktop/PythonProject1/my-chat-app/src/ChatBox.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport axios from 'axios';\r\nimport { Message } from './types';\r\n\r\nconst socket: Socket = io('http://localhost:3001'); // Porta NestJS WebSocket\r\n\r\nconst ChatBox: React.FC = () => {\r\n  const [sender, setSender] = useState('');\r\n  const [text, setText] = useState('');\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n\r\n  useEffect(() => {\r\n    console.log('📡 Connessione WebSocket avviata');\r\n\r\n    socket.on('message', (message: Message) => {\r\n      console.log('📥 Messaggio ricevuto via WebSocket:', message);\r\n\r\n      // Mostra subito il messaggio dell’utente\r\n      if (!message.isGenerated) {\r\n        setMessages((prev) => [...prev, message]);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.off('message');\r\n      console.log('🔌 Connessione WebSocket chiusa');\r\n    };\r\n  }, []);\r\n\r\n  const sendMessage = async () => {\r\n    if (!sender.trim() || !text.trim()) {\r\n      console.warn('⚠️ Nome utente o messaggio vuoto, annullato.');\r\n      return;\r\n    }\r\n\r\n    const userMsg: Message = {\r\n      sender,\r\n      text,\r\n      isGenerated: false,\r\n    };\r\n\r\n    console.log('✉️ Invio messaggio utente:', userMsg);\r\n    setMessages((prev) => [...prev, userMsg]);\r\n\r\n    socket.emit('message', userMsg);\r\n    console.log('📡 Messaggio inviato via WebSocket');\r\n\r\n    const loadingMsg: Message = {\r\n      sender: 'AI',\r\n      text: 'Sta scrivendo...',\r\n      isGenerated: true,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, loadingMsg]);\r\n    console.log('⏳ Messaggio \"Sta scrivendo...\" aggiunto');\r\n\r\n    try {\r\n      console.log('🔗 Chiamata a FastAPI...');\r\n      const response = await axios.post('http://localhost:8000/ai', {\r\n        message: text,\r\n      });\r\n      console.log('✅ Risposta FastAPI:', response.data);\r\n\r\n      const aiMsg: Message = {\r\n        sender: 'AI',\r\n        text: response.data.response,\r\n        isGenerated: true,\r\n      };\r\n\r\n      setMessages((prev) => {\r\n        const updated = [...prev];\r\n        const index = updated.findIndex(\r\n          (m) => m.sender === 'AI' && m.text === 'Sta scrivendo...'\r\n        );\r\n        if (index !== -1) updated.splice(index, 1);\r\n        return [...updated, aiMsg];\r\n      });\r\n\r\n      console.log('🤖 Risposta AI aggiunta alla chat:', aiMsg);\r\n    } catch (err: any) {\r\n      console.error('❌ Errore FastAPI:', err.response?.data || err.message || err);\r\n\r\n      setMessages((prev) => [\r\n        ...prev.filter((m) => m.text !== 'Sta scrivendo...'),\r\n        {\r\n          sender: 'AI',\r\n          text: '[Errore nella risposta AI]',\r\n          isGenerated: true,\r\n        },\r\n      ]);\r\n    }\r\n\r\n    setText('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-container\">\r\n      <h1>Chat Realtime + AI</h1>\r\n      <div className=\"input-group\">\r\n        <input\r\n          value={sender}\r\n          onChange={(e) => setSender(e.target.value)}\r\n          placeholder=\"Your name\"\r\n        />\r\n        <input\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}\r\n          placeholder=\"Message\"\r\n        />\r\n        <button onClick={sendMessage}>Send</button>\r\n      </div>\r\n\r\n      <ul>\r\n        {messages.map((msg, i) => (\r\n          <li key={i} className={msg.isGenerated ? 'ai' : 'user'}>\r\n            <div className=\"message-row\">\r\n              <span className=\"avatar\">{msg.isGenerated ? '🤖' : '👤'}</span>\r\n              <div className=\"bubble\">\r\n                <strong>{msg.sender}:</strong> {msg.text}\r\n              </div>\r\n            </div>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}