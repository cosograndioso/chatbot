{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\video\\\\Desktop\\\\PythonProject1\\\\my-chat-app\\\\src\\\\ChatBox.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport axios from 'axios';\nconst socket = io('http://localhost:3001'); // Porta NestJS WebSocket\n\nconst ChatBox = () => {\n  const [sender, setSender] = useState('');\n  const [text, setText] = useState('');\n  const [messages, setMessages] = useState([]);\n  useEffect(() => {\n    socket.on('message', message => {\n      // Evita duplicati o loop infiniti\n      if (!message.isGenerated) {\n        setMessages(prev => [...prev, message]);\n        requestAIResponse(message.text);\n      }\n    });\n    return () => {\n      socket.off('message');\n    };\n  }, []);\n  const requestAIResponse = async msgText => {\n    const loadingId = `loading-${Date.now()}`;\n    const loadingMsg = {\n      id: loadingId,\n      sender: 'AI',\n      text: 'Sta scrivendo...',\n      isGenerated: true\n    };\n    setMessages(prev => [...prev, loadingMsg]);\n    try {\n      const response = await axios.post('http://localhost:8000/ai', {\n        message: msgText\n      });\n      const aiMsg = {\n        sender: 'AI',\n        text: response.data.response,\n        isGenerated: true\n      };\n\n      // Rimuove il messaggio \"Sta scrivendo...\" e aggiunge la risposta\n      setMessages(prev => prev.filter(m => m.id !== loadingId).concat(aiMsg));\n    } catch (err) {\n      console.error('❌ Errore FastAPI:', err);\n      setMessages(prev => prev.filter(m => m.id !== loadingId).concat({\n        sender: 'AI',\n        text: '[Errore durante la risposta AI]',\n        isGenerated: true\n      }));\n    }\n  };\n  const sendMessage = () => {\n    if (!sender.trim() || !text.trim()) return;\n    const userMsg = {\n      sender,\n      text,\n      isGenerated: false\n    };\n\n    // Invia il messaggio agli altri tramite WebSocket\n    socket.emit('message', userMsg);\n    setText('');\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }\n  }, \"Chat Realtime + AI\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    value: sender,\n    onChange: e => setSender(e.target.value),\n    placeholder: \"Your name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    value: text,\n    onChange: e => setText(e.target.value),\n    onKeyDown: e => e.key === 'Enter' && sendMessage(),\n    placeholder: \"Message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  }, \"Send\")), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }\n  }, messages.map((msg, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    className: msg.isGenerated ? 'ai' : 'user',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"message-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 15\n    }\n  }, msg.isGenerated ? '🤖' : '👤'), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bubble\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 17\n    }\n  }, msg.sender, \":\"), \" \", msg.text))))));\n};\nexport default ChatBox;","map":{"version":3,"names":["React","useEffect","useState","io","axios","socket","ChatBox","sender","setSender","text","setText","messages","setMessages","on","message","isGenerated","prev","requestAIResponse","off","msgText","loadingId","Date","now","loadingMsg","id","response","post","aiMsg","data","filter","m","concat","err","console","error","sendMessage","trim","userMsg","emit","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","placeholder","onKeyDown","key","onClick","map","msg","i"],"sources":["C:/Users/video/Desktop/PythonProject1/my-chat-app/src/ChatBox.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport axios from 'axios';\r\nimport { Message } from './types';\r\n\r\nconst socket: Socket = io('http://localhost:3001'); // Porta NestJS WebSocket\r\n\r\nconst ChatBox: React.FC = () => {\r\n  const [sender, setSender] = useState('');\r\n  const [text, setText] = useState('');\r\n  const [messages, setMessages] = useState<(Message & { id?: string })[]>([]);\r\n\r\n  useEffect(() => {\r\n    socket.on('message', (message: Message) => {\r\n      // Evita duplicati o loop infiniti\r\n      if (!message.isGenerated) {\r\n        setMessages((prev) => [...prev, message]);\r\n        requestAIResponse(message.text);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.off('message');\r\n    };\r\n  }, []);\r\n\r\n  const requestAIResponse = async (msgText: string) => {\r\n    const loadingId = `loading-${Date.now()}`;\r\n    const loadingMsg: Message & { id: string } = {\r\n      id: loadingId,\r\n      sender: 'AI',\r\n      text: 'Sta scrivendo...',\r\n      isGenerated: true,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, loadingMsg]);\r\n\r\n    try {\r\n      const response = await axios.post('http://localhost:8000/ai', {\r\n        message: msgText,\r\n      });\r\n\r\n      const aiMsg: Message = {\r\n        sender: 'AI',\r\n        text: response.data.response,\r\n        isGenerated: true,\r\n      };\r\n\r\n      // Rimuove il messaggio \"Sta scrivendo...\" e aggiunge la risposta\r\n      setMessages((prev) =>\r\n        prev.filter((m) => m.id !== loadingId).concat(aiMsg)\r\n      );\r\n    } catch (err) {\r\n      console.error('❌ Errore FastAPI:', err);\r\n      setMessages((prev) =>\r\n        prev.filter((m) => m.id !== loadingId).concat({\r\n          sender: 'AI',\r\n          text: '[Errore durante la risposta AI]',\r\n          isGenerated: true,\r\n        })\r\n      );\r\n    }\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    if (!sender.trim() || !text.trim()) return;\r\n\r\n    const userMsg: Message = {\r\n      sender,\r\n      text,\r\n      isGenerated: false,\r\n    };\r\n\r\n    // Invia il messaggio agli altri tramite WebSocket\r\n    socket.emit('message', userMsg);\r\n    setText('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-container\">\r\n      <h1>Chat Realtime + AI</h1>\r\n      <div className=\"input-group\">\r\n        <input\r\n          value={sender}\r\n          onChange={(e) => setSender(e.target.value)}\r\n          placeholder=\"Your name\"\r\n        />\r\n        <input\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}\r\n          placeholder=\"Message\"\r\n        />\r\n        <button onClick={sendMessage}>Send</button>\r\n      </div>\r\n\r\n      <ul>\r\n        {messages.map((msg, i) => (\r\n          <li key={i} className={msg.isGenerated ? 'ai' : 'user'}>\r\n            <div className=\"message-row\">\r\n              <span className=\"avatar\">{msg.isGenerated ? '🤖' : '👤'}</span>\r\n              <div className=\"bubble\">\r\n                <strong>{msg.sender}:</strong> {msg.text}\r\n              </div>\r\n            </div>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}