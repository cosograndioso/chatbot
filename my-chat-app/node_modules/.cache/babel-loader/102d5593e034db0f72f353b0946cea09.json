{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\video\\\\Desktop\\\\PythonProject1\\\\my-chat-app\\\\src\\\\ChatBox.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport axios from 'axios';\nconst socket = io('http://localhost:3001'); // Porta NestJS WebSocket\n\nconst ChatBox = () => {\n  const [sender, setSender] = useState('');\n  const [text, setText] = useState('');\n  const [messages, setMessages] = useState([]);\n  useEffect(() => {\n    socket.on('message', message => {\n      // Mostra subito il messaggio dell’utente\n      if (!message.isGenerated) {\n        setMessages(prev => [...prev, message]);\n      }\n    });\n    return () => {\n      socket.off('message');\n    };\n  }, []);\n  const sendMessage = async () => {\n    if (!sender.trim() || !text.trim()) return;\n    const userMsg = {\n      sender,\n      text,\n      isGenerated: false\n    };\n\n    // Mostra subito il messaggio dell'utente localmente\n    setMessages(prev => [...prev, userMsg]);\n\n    // Invia il messaggio agli altri utenti\n    socket.emit('message', userMsg);\n\n    // Aggiungi messaggio \"sta scrivendo...\"\n    const loadingMsg = {\n      sender: 'AI',\n      text: 'Sta scrivendo...',\n      isGenerated: true\n    };\n    setMessages(prev => [...prev, loadingMsg]);\n\n    // Chiamata a FastAPI\n    try {\n      const response = await axios.post('http://localhost:8000/ai', {\n        message: text\n      });\n      const aiMsg = {\n        sender: 'AI',\n        text: response.data.response,\n        isGenerated: true\n      };\n\n      // Rimuovi \"Sta scrivendo...\" e aggiungi la risposta AI\n      setMessages(prev => {\n        const updated = [...prev];\n        const index = updated.findIndex(m => m.sender === 'AI' && m.text === 'Sta scrivendo...');\n        if (index !== -1) updated.splice(index, 1);\n        return [...updated, aiMsg];\n      });\n    } catch (err) {\n      console.error('❌ Errore FastAPI:', err);\n      setMessages(prev => [...prev.filter(m => m.text !== 'Sta scrivendo...'), {\n        sender: 'AI',\n        text: '[Errore nella risposta AI]',\n        isGenerated: true\n      }]);\n    }\n    setText('');\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }\n  }, \"Chat Realtime + AI\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    value: sender,\n    onChange: e => setSender(e.target.value),\n    placeholder: \"Your name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    value: text,\n    onChange: e => setText(e.target.value),\n    onKeyDown: e => e.key === 'Enter' && sendMessage(),\n    placeholder: \"Message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }\n  }, \"Send\")), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }\n  }, messages.map((msg, i) => /*#__PURE__*/React.createElement(\"li\", {\n    key: i,\n    className: msg.isGenerated ? 'ai' : 'user',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"message-row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 15\n    }\n  }, msg.isGenerated ? '🤖' : '👤'), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bubble\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 17\n    }\n  }, msg.sender, \":\"), \" \", msg.text))))));\n};\nexport default ChatBox;","map":{"version":3,"names":["React","useEffect","useState","io","axios","socket","ChatBox","sender","setSender","text","setText","messages","setMessages","on","message","isGenerated","prev","off","sendMessage","trim","userMsg","emit","loadingMsg","response","post","aiMsg","data","updated","index","findIndex","m","splice","err","console","error","filter","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","placeholder","onKeyDown","key","onClick","map","msg","i"],"sources":["C:/Users/video/Desktop/PythonProject1/my-chat-app/src/ChatBox.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport axios from 'axios';\r\nimport { Message } from './types';\r\n\r\nconst socket: Socket = io('http://localhost:3001'); // Porta NestJS WebSocket\r\n\r\nconst ChatBox: React.FC = () => {\r\n  const [sender, setSender] = useState('');\r\n  const [text, setText] = useState('');\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n\r\n  useEffect(() => {\r\n    socket.on('message', (message: Message) => {\r\n      // Mostra subito il messaggio dell’utente\r\n      if (!message.isGenerated) {\r\n        setMessages((prev) => [...prev, message]);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.off('message');\r\n    };\r\n  }, []);\r\n\r\n  const sendMessage = async () => {\r\n    if (!sender.trim() || !text.trim()) return;\r\n\r\n    const userMsg: Message = {\r\n      sender,\r\n      text,\r\n      isGenerated: false,\r\n    };\r\n\r\n    // Mostra subito il messaggio dell'utente localmente\r\n    setMessages((prev) => [...prev, userMsg]);\r\n\r\n    // Invia il messaggio agli altri utenti\r\n    socket.emit('message', userMsg);\r\n\r\n    // Aggiungi messaggio \"sta scrivendo...\"\r\n    const loadingMsg: Message = {\r\n      sender: 'AI',\r\n      text: 'Sta scrivendo...',\r\n      isGenerated: true,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, loadingMsg]);\r\n\r\n    // Chiamata a FastAPI\r\n    try {\r\n      const response = await axios.post('http://localhost:8000/ai', {\r\n        message: text,\r\n      });\r\n\r\n      const aiMsg: Message = {\r\n        sender: 'AI',\r\n        text: response.data.response,\r\n        isGenerated: true,\r\n      };\r\n\r\n      // Rimuovi \"Sta scrivendo...\" e aggiungi la risposta AI\r\n      setMessages((prev) => {\r\n        const updated = [...prev];\r\n        const index = updated.findIndex(\r\n          (m) => m.sender === 'AI' && m.text === 'Sta scrivendo...'\r\n        );\r\n        if (index !== -1) updated.splice(index, 1);\r\n        return [...updated, aiMsg];\r\n      });\r\n    } catch (err) {\r\n      console.error('❌ Errore FastAPI:', err);\r\n      setMessages((prev) => [\r\n        ...prev.filter((m) => m.text !== 'Sta scrivendo...'),\r\n        {\r\n          sender: 'AI',\r\n          text: '[Errore nella risposta AI]',\r\n          isGenerated: true,\r\n        },\r\n      ]);\r\n    }\r\n\r\n    setText('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-container\">\r\n      <h1>Chat Realtime + AI</h1>\r\n      <div className=\"input-group\">\r\n        <input\r\n          value={sender}\r\n          onChange={(e) => setSender(e.target.value)}\r\n          placeholder=\"Your name\"\r\n        />\r\n        <input\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}\r\n          placeholder=\"Message\"\r\n        />\r\n        <button onClick={sendMessage}>Send</button>\r\n      </div>\r\n\r\n      <ul>\r\n        {messages.map((msg, i) => (\r\n          <li key={i} className={msg.isGenerated ? 'ai' : 'user'}>\r\n            <div className=\"message-row\">\r\n              <span className=\"avatar\">{msg.isGenerated ? '🤖' : '👤'}</span>\r\n              <div className=\"bubble\">\r\n                <strong>{msg.sender}:</strong> {msg.text}\r\n              </div>\r\n            </div>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatBox;\r\n"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,EAAE,QAAgB,kBAAkB;AAC7C,OAAOC,KAAK,MAAM,OAAO;AAGzB,MAAMC,MAAc,GAAGF,EAAE,CAAC,uBAAuB,CAAC,CAAC,CAAC;;AAEpD,MAAMG,OAAiB,GAAGA,CAAA,KAAM;EAC9B,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGN,QAAQ,CAAC,EAAE,CAAC;EACxC,MAAM,CAACO,IAAI,EAAEC,OAAO,CAAC,GAAGR,QAAQ,CAAC,EAAE,CAAC;EACpC,MAAM,CAACS,QAAQ,EAAEC,WAAW,CAAC,GAAGV,QAAQ,CAAY,EAAE,CAAC;EAEvDD,SAAS,CAAC,MAAM;IACdI,MAAM,CAACQ,EAAE,CAAC,SAAS,EAAGC,OAAgB,IAAK;MACzC;MACA,IAAI,CAACA,OAAO,CAACC,WAAW,EAAE;QACxBH,WAAW,CAAEI,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEF,OAAO,CAAC,CAAC;MAC3C;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MACXT,MAAM,CAACY,GAAG,CAAC,SAAS,CAAC;IACvB,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMC,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,IAAI,CAACX,MAAM,CAACY,IAAI,CAAC,CAAC,IAAI,CAACV,IAAI,CAACU,IAAI,CAAC,CAAC,EAAE;IAEpC,MAAMC,OAAgB,GAAG;MACvBb,MAAM;MACNE,IAAI;MACJM,WAAW,EAAE;IACf,CAAC;;IAED;IACAH,WAAW,CAAEI,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEI,OAAO,CAAC,CAAC;;IAEzC;IACAf,MAAM,CAACgB,IAAI,CAAC,SAAS,EAAED,OAAO,CAAC;;IAE/B;IACA,MAAME,UAAmB,GAAG;MAC1Bf,MAAM,EAAE,IAAI;MACZE,IAAI,EAAE,kBAAkB;MACxBM,WAAW,EAAE;IACf,CAAC;IAEDH,WAAW,CAAEI,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEM,UAAU,CAAC,CAAC;;IAE5C;IACA,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMnB,KAAK,CAACoB,IAAI,CAAC,0BAA0B,EAAE;QAC5DV,OAAO,EAAEL;MACX,CAAC,CAAC;MAEF,MAAMgB,KAAc,GAAG;QACrBlB,MAAM,EAAE,IAAI;QACZE,IAAI,EAAEc,QAAQ,CAACG,IAAI,CAACH,QAAQ;QAC5BR,WAAW,EAAE;MACf,CAAC;;MAED;MACAH,WAAW,CAAEI,IAAI,IAAK;QACpB,MAAMW,OAAO,GAAG,CAAC,GAAGX,IAAI,CAAC;QACzB,MAAMY,KAAK,GAAGD,OAAO,CAACE,SAAS,CAC5BC,CAAC,IAAKA,CAAC,CAACvB,MAAM,KAAK,IAAI,IAAIuB,CAAC,CAACrB,IAAI,KAAK,kBACzC,CAAC;QACD,IAAImB,KAAK,KAAK,CAAC,CAAC,EAAED,OAAO,CAACI,MAAM,CAACH,KAAK,EAAE,CAAC,CAAC;QAC1C,OAAO,CAAC,GAAGD,OAAO,EAAEF,KAAK,CAAC;MAC5B,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOO,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,mBAAmB,EAAEF,GAAG,CAAC;MACvCpB,WAAW,CAAEI,IAAI,IAAK,CACpB,GAAGA,IAAI,CAACmB,MAAM,CAAEL,CAAC,IAAKA,CAAC,CAACrB,IAAI,KAAK,kBAAkB,CAAC,EACpD;QACEF,MAAM,EAAE,IAAI;QACZE,IAAI,EAAE,4BAA4B;QAClCM,WAAW,EAAE;MACf,CAAC,CACF,CAAC;IACJ;IAEAL,OAAO,CAAC,EAAE,CAAC;EACb,CAAC;EAED,oBACEV,KAAA,CAAAoC,aAAA;IAAKC,SAAS,EAAC,gBAAgB;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC7B3C,KAAA,CAAAoC,aAAA;IAAAE,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAI,oBAAsB,CAAC,eAC3B3C,KAAA,CAAAoC,aAAA;IAAKC,SAAS,EAAC,aAAa;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC1B3C,KAAA,CAAAoC,aAAA;IACEQ,KAAK,EAAErC,MAAO;IACdsC,QAAQ,EAAGC,CAAC,IAAKtC,SAAS,CAACsC,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE;IAC3CI,WAAW,EAAC,WAAW;IAAAV,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CACxB,CAAC,eACF3C,KAAA,CAAAoC,aAAA;IACEQ,KAAK,EAAEnC,IAAK;IACZoC,QAAQ,EAAGC,CAAC,IAAKpC,OAAO,CAACoC,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE;IACzCK,SAAS,EAAGH,CAAC,IAAKA,CAAC,CAACI,GAAG,KAAK,OAAO,IAAIhC,WAAW,CAAC,CAAE;IACrD8B,WAAW,EAAC,SAAS;IAAAV,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,CACtB,CAAC,eACF3C,KAAA,CAAAoC,aAAA;IAAQe,OAAO,EAAEjC,WAAY;IAAAoB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,MAAY,CACvC,CAAC,eAEN3C,KAAA,CAAAoC,aAAA;IAAAE,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GACGhC,QAAQ,CAACyC,GAAG,CAAC,CAACC,GAAG,EAAEC,CAAC,kBACnBtD,KAAA,CAAAoC,aAAA;IAAIc,GAAG,EAAEI,CAAE;IAACjB,SAAS,EAAEgB,GAAG,CAACtC,WAAW,GAAG,IAAI,GAAG,MAAO;IAAAuB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACrD3C,KAAA,CAAAoC,aAAA;IAAKC,SAAS,EAAC,aAAa;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC1B3C,KAAA,CAAAoC,aAAA;IAAMC,SAAS,EAAC,QAAQ;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAEU,GAAG,CAACtC,WAAW,GAAG,IAAI,GAAG,IAAW,CAAC,eAC/Df,KAAA,CAAAoC,aAAA;IAAKC,SAAS,EAAC,QAAQ;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACrB3C,KAAA,CAAAoC,aAAA;IAAAE,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAASU,GAAG,CAAC9C,MAAM,EAAC,GAAS,CAAC,KAAC,EAAC8C,GAAG,CAAC5C,IACjC,CACF,CACH,CACL,CACC,CACD,CAAC;AAEV,CAAC;AAED,eAAeH,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module"}